///////////////////////////////////////////////////////////////
//
//  This is a class writes stitched results from array to a file
//
//  Author:Sydney Lyon
//  Date Started: 7/7/2016
//  Last Worked: 7/12/2016
//
///////////////////////////////////////////////////////////////

import java.util.ArrayList;
import java.io.FileWriter;
import java.io.BufferedWriter;
import java.io.PrintWriter;
import java.io.IOException;
import java.io.File;
import java.nio.file.Path;

public class Writer{
  private String path;
  private ArrayList<String[]> list;
  private static final String NEW_LINE = "\n";
  private static final String COMMA = ",";
  
    
  public Writer(String path, ArrayList<String[]> list){
    this.path = path;
    this.list = list;
  }
  
  public void run(){
    write();
  }
  
  public String arrayToString(String[] input){
    String[] in = input;
    String out = "";
    int size = in.length;
    for(int i=0; i<size; i++){
      if(i==0){
        out += in[i];
      }else{
        out += COMMA + in[i];
      }
    }
    out += NEW_LINE;
  
    return out;
  }
  
  
  public String listToString(){
    String out= "";
    int len = list.size();
    for(int i=0; i<len; i++){
      out += arrayToString(list.get(i));
    }
    return out;
  }
  
  public void write(){
    String writeString = listToString();
    try(FileWriter fw = new FileWriter(path + ".temp", true);
        BufferedWriter bw = new BufferedWriter(fw);
        PrintWriter out = new PrintWriter(bw))
    {
      out.println(writeString);

      
    } catch (IOException e) {
        e.printStackTrace();
    }
    
    rename();
  }
  
  public void rename(){
    File old = new File(path);
    File temp = new File(path + ".temp");
    // This function allows the temp file to be renamed, essentially deleting the
    // records of flows that need to be further analyzed and rewritten later ***************************************
    old.delete();
    temp.renameTo(old);
    while(!temp.renameTo(old)){
      System.out.println("Couldn't rename file");
      temp.renameTo(old);
    }
  }
  
  public static void main(String[] args){
    //Reader test1 = new Reader("C:\\Users\\sylyon\\Documents\\Java\\Stitching\\01.csv");
    //ArrayList<String[]> testList = test1.run();
    //Writer test2 = new Writer("temp", testList);
    //System.out.println(test2.listToString());
  }
}