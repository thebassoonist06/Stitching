///////////////////////////////////////////////////////////////
//
//  This is a class runs through the files in a directory and
//  stitches them together
//
//  Author:Sydney Lyon
//  Date Started: 7/7/2016
//  Last Worked: 7/7/2016
//
///////////////////////////////////////////////////////////////

import java.io.File;
import java.util.ArrayList;
import java.nio.file.Files;
  
public class FileWalker{
  
  private String path;
  private File[] directoryListing;
  private int size;
  Stitcher st;
    
  
  public FileWalker(String path){
    this.path = path;
    directoryListing = null;
    st = null;
    size = 0;
  }
  
  
  // gets all the file paths in a directory and stores them
  // as a string in an arrayList
  public void getFiles(){
    File dir = new File(path);
    directoryListing = dir.listFiles();
    size = directoryListing.length;
  }
  
  public void stitchFiles(){
    // creates the array of absolute paths we are working with
    getFiles();
    // sets both paths to the empty string everytime the program is run
    String path1 = "";
    String path2 = "";
    // makes size one less, so that the loop stops at second to last
    // and last items in the array
    size--;
    // temporary holding for the list we are working on
    ArrayList<String[]> bucket = null;
    
    // this loop works by using two file paths in the array and creating
    // a new stitching object for them.
    for(int i=0; i<size; i++){
      
      if(i == 0){
        // special case for the first two, we will need
        // two readers set up, so we use the first stitcher
        // constructor type
        path1 = directoryListing[i].getPath();
        path2 = directoryListing[i+1].getPath();
        st = new Stitcher(path1, path2);
        st.run();
        // stores the second list in our bucket 
        // so that we can use it in our else case
        bucket = st.getList();
        // prints results
        System.out.println(st.testToString());
      }else{
        // switches our day two to day one and gets
        // next day's path to stitch them together
        path1 = path2;
        path2 = directoryListing[i+1].getPath();
        st = new Stitcher(bucket, path1, path2);
        st.run();
        // updates the bucket
        bucket = st.getList();
        // prints results
        System.out.println(st.testToString());
      }
    }
    // writes the flows of the last stitch
    // stitcher only writes the first file
    // so we can carry over the lists
    Writer wr = new Writer(path2, bucket);
    wr.write();
    
  }
  
  
  // prints the results of stitch testing and any
  // other useful testing data
  public String testToString(){
    String out = "";
    out += st.testToString();
    return out;
  }
  
  
  // runs necessary class functions
  public void run(){
    stitchFiles();
    
  }
  
  
  public static void main(String[] args){
    final long startTime = System.nanoTime();
    FileWalker fw = new FileWalker("C:\\Users\\sylyon\\Documents\\Java\\Stitching");
    fw.run();
    final long duration = System.nanoTime() - startTime;
    System.out.println("" + duration/1000000000 + " sec");
  }

}